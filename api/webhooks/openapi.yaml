openapi: 3.1.0
info:
  title: MCP Any Webhook API
  version: 1.0.0
  description: |
    Specification for Webhooks used by MCP Any Core.
    Webhooks receive CloudEvents containing tool execution details or results,
    and return CloudEvents with review decisions or modifications.
paths:
  /webhook:
    post:
      summary: Handle Webhook Event
      description: |
        Receives a pre-call or post-call event from MCP Any.
        Returns a response event indicating allowance or modification.
      requestBody:
        required: true
        content:
          application/cloudevents+json:
            schema:
              type: object
              properties:
                specversion:
                  type: string
                  const: "1.0"
                type:
                  type: string
                  enum:
                    - com.mcpany.tool.pre_call
                    - com.mcpany.tool.post_call
                source:
                  type: string
                  format: uri
                id:
                  type: string
                time:
                  type: string
                  format: date-time
                datacontenttype:
                  type: string
                  const: application/json
                data:
                  oneOf:
                    - $ref: '#/components/schemas/PreCallData'
                    - $ref: '#/components/schemas/PostCallData'
      responses:
        '200':
          description: Successful response with review decision
          content:
            application/cloudevents+json:
              schema:
                type: object
                properties:
                  specversion:
                    type: string
                    const: "1.0"
                  type:
                    type: string
                    const: com.mcpany.webhook.response
                  source:
                    type: string
                    format: uri
                  id:
                    type: string
                  time:
                    type: string
                    format: date-time
                  datacontenttype:
                    type: string
                    const: application/json
                  data:
                    $ref: '#/components/schemas/ResponseData'
        '4xx':
          description: Client Error
        '5xx':
          description: Server Error

components:
  schemas:
    PreCallData:
      type: object
      properties:
        tool_name:
          type: string
        inputs:
          type: object
          description: Map of tool inputs
      required:
        - tool_name
        - inputs

    PostCallData:
      type: object
      properties:
        tool_name:
          type: string
        result:
          type: object
          nullable: true
          description: Tool execution result (any type)
      required:
        - tool_name

    ResponseData:
      type: object
      properties:
        allowed:
          type: boolean
          description: Whether the operation is allowed (default true for modification hooks)
        status:
          type: object
          properties:
            code:
              type: integer
            message:
              type: string
          nullable: true
        replacement_object:
          type: object
          nullable: true
          description: |
            New inputs (for PreCall) or new result (for PostCall).
            If present, this replaces the original object.
      required:
        - allowed
