make: Entering directory '/usr/local/google/home/kxw/core/server'
Cleaning generated protobuf files...
Preparing development environment...
protoc version v33.1 is already installed.
Installing Go protobuf plugins...
Checking for Go protobuf plugins...
Go protobuf plugins installation check complete.
Checking for Python to install dependencies and pre-commit hooks...
Python found. Installing/updating pre-commit and fastmcp locally...
pre-commit installed at .git/hooks/pre-commit
Installing Node.js dependencies for integration tests...
Found package.json, running npm install...

up to date, audited 615 packages in 917ms

152 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
Installing Playwright browsers (skipping system deps)...
Playwright Host validation warning:
╔══════════════════════════════════════════════════════╗
║ Host system is missing dependencies to run browsers. ║
║ Please install them with the following command:      ║
║                                                      ║
║     sudo npx playwright install-deps                 ║
║                                                      ║
║ Alternatively, use apt:                              ║
║     sudo apt-get install libevent-2.1-7t64           ║
║                                                      ║
║ <3 Playwright Team                                   ║
╚══════════════════════════════════════════════════════╝
    at validateDependenciesLinux (/usr/local/google/home/kxw/core/server/tests/integration/upstream/node_modules/playwright-core/lib/server/registry/dependencies.js:285:9)
    at async Registry._validateHostRequirements (/usr/local/google/home/kxw/core/server/tests/integration/upstream/node_modules/playwright-core/lib/server/registry/index.js:977:14)
    at async Registry._validateHostRequirementsForExecutableIfNeeded (/usr/local/google/home/kxw/core/server/tests/integration/upstream/node_modules/playwright-core/lib/server/registry/index.js:1099:7)
    at async Registry.validateHostRequirementsForExecutablesIfNeeded (/usr/local/google/home/kxw/core/server/tests/integration/upstream/node_modules/playwright-core/lib/server/registry/index.js:1088:7)
    at async i.<anonymous> (/usr/local/google/home/kxw/core/server/tests/integration/upstream/node_modules/playwright-core/lib/cli/program.js:233:7)
Checking for Helm...
Helm is already installed.
Checking for ShellCheck...
ShellCheck is already installed.
Checking for nats-server...
nats-server is already installed.
Checking for golangci-lint...
Installing golangci-lint v2.7.2 to /usr/local/google/home/kxw/core/build/env/bin...
golangci/golangci-lint info checking GitHub for tag 'v2.7.2'
golangci/golangci-lint info found version: 2.7.2 for v2.7.2/linux/amd64
golangci/golangci-lint info installed /usr/local/google/home/kxw/core/build/env/bin/golangci-lint
golangci-lint installed successfully.
Downloading go modules...
Preparation complete.
Removing old protobuf files...
Generating protobuf files...
Using protoc: libprotoc 33.1
Protobuf generation complete.
Building Go project locally...
Building weather server example...
make[1]: Entering directory '/usr/local/google/home/kxw/core/server'
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/http_echo_server' is up to date.
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/http_authed_echo_server' is up to date.
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/grpc_weather_server' is up to date.
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/grpc_authed_weather_server' is up to date.
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/openapi_weather_server' is up to date.
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/webrtc_weather_server' is up to date.
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/command-tester' is up to date.
make[1]: '/usr/local/google/home/kxw/core/build/test/bin/prompt-server' is up to date.
make[1]: Leaving directory '/usr/local/google/home/kxw/core/server'
make[1]: Entering directory '/usr/local/google/home/kxw/core/server'
Building file upload server example...
make[1]: Leaving directory '/usr/local/google/home/kxw/core/server'
Building E2E time server Docker image (mcpany-e2e-time-server)...
#0 building with "multiarchbuilder" instance using docker-container driver

#1 [internal] load build definition from Dockerfile.timeserver
#1 transferring dockerfile: 864B done
#1 DONE 0.0s

#2 [internal] load metadata for mirror.gcr.io/library/python:3.11-slim
#2 DONE 1.0s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 134B done
#4 DONE 0.0s

#5 [1/5] FROM mirror.gcr.io/library/python:3.11-slim@sha256:158caf0e080e2cd74ef2879ed3c4e697792ee65251c8208b7afb56683c32ea6c
#5 resolve mirror.gcr.io/library/python:3.11-slim@sha256:158caf0e080e2cd74ef2879ed3c4e697792ee65251c8208b7afb56683c32ea6c 0.0s done
#5 DONE 0.0s

#6 [2/5] WORKDIR /app
#6 CACHED

#7 [3/5] COPY timeserver_patch/requirements.txt .
#7 CACHED

#8 [4/5] RUN pip install -r requirements.txt
#8 CACHED

#9 [5/5] COPY timeserver_patch/main.py /app/main.py
#9 CACHED

#10 exporting to docker image format
#10 exporting layers done
#10 exporting manifest sha256:fa0cdc7a8092034b6e9d1918fb619fdb16bdab5e1240ae11a0a50e34ca613ae9 done
#10 exporting config sha256:7b368ea2c4e14e49b78fd81e6817e23521f66285ac9d4de880403d0e21a813f0 done
#10 sending tarball
#10 sending tarball 0.6s done
#10 DONE 0.6s

#11 importing to docker
#11 DONE 0.0s
Running fast Go tests locally with a 300s timeout...
	github.com/mcpany/core/cmd/mock_mcp_server		coverage: 0.0% of statements
ok  	github.com/mcpany/core/cmd/server	2.939s	coverage: 67.8% of statements
	github.com/mcpany/core/cmd/webhooks		coverage: 0.0% of statements
ok  	github.com/mcpany/core/cmd/webhooks/hooks	1.048s	coverage: 84.7% of statements
ok  	github.com/mcpany/core/cmd/worker	1.259s	coverage: 92.9% of statements
ok  	github.com/mcpany/core/pkg/app	22.906s	coverage: 74.8% of statements
?   	github.com/mcpany/core/pkg/appconsts	[no test files]
ok  	github.com/mcpany/core/pkg/auth	2.549s	coverage: 94.0% of statements
ok  	github.com/mcpany/core/pkg/bus	12.632s	coverage: 80.6% of statements
ok  	github.com/mcpany/core/pkg/bus/kafka	1.273s	coverage: 82.1% of statements
ok  	github.com/mcpany/core/pkg/bus/memory	1.097s	coverage: 100.0% of statements
ok  	github.com/mcpany/core/pkg/bus/nats	1.858s	coverage: 86.8% of statements
ok  	github.com/mcpany/core/pkg/bus/redis	3.910s	coverage: 75.8% of statements
ok  	github.com/mcpany/core/pkg/cli	1.024s	coverage: 100.0% of statements
ok  	github.com/mcpany/core/pkg/client	2.128s	coverage: 94.1% of statements
ok  	github.com/mcpany/core/pkg/config	2.646s	coverage: 88.4% of statements
?   	github.com/mcpany/core/pkg/consts	[no test files]
ok  	github.com/mcpany/core/pkg/health	1.592s	coverage: 90.1% of statements
ok  	github.com/mcpany/core/pkg/logging	1.050s	coverage: 90.5% of statements
ok  	github.com/mcpany/core/pkg/mcpserver	1.719s	coverage: 83.4% of statements
ok  	github.com/mcpany/core/pkg/metrics	1.195s	coverage: 90.6% of statements
ok  	github.com/mcpany/core/pkg/middleware	1.252s	coverage: 87.1% of statements
ok  	github.com/mcpany/core/pkg/pool	6.158s	coverage: 86.5% of statements
ok  	github.com/mcpany/core/pkg/prompt	1.144s	coverage: 98.3% of statements
ok  	github.com/mcpany/core/pkg/resilience	1.177s	coverage: 94.2% of statements
ok  	github.com/mcpany/core/pkg/resource	1.156s	coverage: 98.2% of statements
ok  	github.com/mcpany/core/pkg/service	1.210s	coverage: 85.7% of statements
ok  	github.com/mcpany/core/pkg/serviceregistry	1.326s	coverage: 93.1% of statements
ok  	github.com/mcpany/core/pkg/storage/sql	1.209s	coverage: 93.2% of statements
ok  	github.com/mcpany/core/pkg/telemetry	1.043s	coverage: 87.0% of statements
	github.com/mcpany/core/pkg/testutil		coverage: 0.0% of statements
ok  	github.com/mcpany/core/pkg/tool	4.201s	coverage: 81.0% of statements
ok  	github.com/mcpany/core/pkg/transformer	1.052s	coverage: 92.4% of statements
ok  	github.com/mcpany/core/pkg/update	1.063s	coverage: 84.0% of statements
?   	github.com/mcpany/core/pkg/upstream	[no test files]
ok  	github.com/mcpany/core/pkg/upstream/command	1.164s	coverage: 83.5% of statements
ok  	github.com/mcpany/core/pkg/upstream/factory	1.154s	coverage: 92.3% of statements
ok  	github.com/mcpany/core/pkg/upstream/graphql	1.183s	coverage: 92.1% of statements
ok  	github.com/mcpany/core/pkg/upstream/grpc	11.326s	coverage: 82.6% of statements
ok  	github.com/mcpany/core/pkg/upstream/grpc/protobufparser	11.137s	coverage: 85.3% of statements
ok  	github.com/mcpany/core/pkg/upstream/http	1.290s	coverage: 87.7% of statements
ok  	github.com/mcpany/core/pkg/upstream/mcp	3.773s	coverage: 87.5% of statements
ok  	github.com/mcpany/core/pkg/upstream/openapi	1.230s	coverage: 82.5% of statements
ok  	github.com/mcpany/core/pkg/upstream/webrtc	1.214s	coverage: 91.1% of statements
ok  	github.com/mcpany/core/pkg/upstream/websocket	1.172s	coverage: 90.7% of statements
ok  	github.com/mcpany/core/pkg/util	23.160s	coverage: 89.6% of statements
ok  	github.com/mcpany/core/pkg/util/schemaconv	1.074s	coverage: 88.3% of statements
ok  	github.com/mcpany/core/pkg/util/testutil	1.036s	coverage: 100.0% of statements
ok  	github.com/mcpany/core/pkg/validation	1.060s	coverage: 98.0% of statements
ok  	github.com/mcpany/core/pkg/worker	3.407s	coverage: 92.6% of statements
	github.com/mcpany/core/proto/api/v1		coverage: 0.0% of statements
	github.com/mcpany/core/proto/bus		coverage: 0.0% of statements
	github.com/mcpany/core/proto/config/v1		coverage: 0.0% of statements
	github.com/mcpany/core/proto/examples/userservice/v1		coverage: 0.0% of statements
	github.com/mcpany/core/proto/examples/weather/v1		coverage: 0.0% of statements
	github.com/mcpany/core/proto/mcp_options/v1		coverage: 0.0% of statements
	github.com/mcpany/core/proto/mcp_router/v1		coverage: 0.0% of statements
ok  	github.com/mcpany/core/tests/framework	7.495s	coverage: 6.5% of statements
ok  	github.com/mcpany/core/tests/integration	21.857s	coverage: 50.5% of statements
ok  	github.com/mcpany/core/tests/integration/cmd	1.026s	coverage: [no statements]
	github.com/mcpany/core/tests/integration/cmd/command-tester		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/grpc_authed_weather_server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/grpc_weather_server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/http_authed_echo_server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/http_caching_server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/http_echo_server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/openapi_weather_server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/prompt-server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/webrtc_weather_server		coverage: 0.0% of statements
	github.com/mcpany/core/tests/integration/cmd/mocks/websocket_echo_server		coverage: 0.0% of statements
ok  	github.com/mcpany/core/tests/integration/examples	1.437s	coverage: [no statements]
ok  	github.com/mcpany/core/tests/integration/resilience	1.144s	coverage: [no statements]
ok  	github.com/mcpany/core/tests/integration/upstream	39.813s	coverage: 90.9% of statements
	github.com/mcpany/core/examples/upstream_service_demo/file-upload		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/graphql/server		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/http/client		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/http/server		coverage: 0.0% of statements
ok  	github.com/mcpany/core/examples/upstream_service_demo/http/server/weather_server	1.044s	coverage: 56.6% of statements
	github.com/mcpany/core/examples/upstream_service_demo/openapi/client		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/openapi/server		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/webrtc/client		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/webrtc/server		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/websocket		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/websocket/client		coverage: 0.0% of statements
	github.com/mcpany/core/examples/upstream_service_demo/websocket/echo_server/server		coverage: 0.0% of statements
make: Leaving directory '/usr/local/google/home/kxw/core/server'
