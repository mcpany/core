// Copyright 2025 Author(s) of MCP Any
// SPDX-License-Identifier: Apache-2.0

edition = "2023";

package mcpany.api.v1;

import "google/api/annotations.proto";
import "proto/config/v1/upstream_service.proto";
import "proto/config/v1/resource.proto";
import "proto/config/v1/tool.proto";
import "google/protobuf/go_features.proto";

// option features.(pb.go).api_level = API_OPAQUE;


option go_package = "github.com/mcpany/core/proto/api/v1";
option java_outer_classname = "RegistrationProto";
option features.field_presence = IMPLICIT;

message RegisterServiceRequest {
    mcpany.config.v1.UpstreamServiceConfig config = 1;
}

message RegisterServiceResponse {
    string message = 1;             // e.g., "Service registered successfully"
    repeated mcpany.config.v1.ToolDefinition discovered_tools = 2;
    string service_key = 3;         // The generated key for the service
    repeated mcpany.config.v1.ResourceDefinition discovered_resources = 4;
}

message ValidateServiceRequest {
    mcpany.config.v1.UpstreamServiceConfig config = 1;
}

message ValidateServiceResponse {
    bool valid = 1;
    string message = 2;
    repeated mcpany.config.v1.ToolDefinition discovered_tools = 3;
    repeated mcpany.config.v1.ResourceDefinition discovered_resources = 4;
}

service RegistrationService {
    rpc RegisterService(RegisterServiceRequest) returns (RegisterServiceResponse) {
        option (google.api.http) = {
            post: "/v1/services/register"
            body: "*"
        };
    }
    rpc ValidateService(ValidateServiceRequest) returns (ValidateServiceResponse) {
        option (google.api.http) = {
            post: "/v1/services/validate"
            body: "*"
        };
    }
    rpc UnregisterService(UnregisterServiceRequest) returns (UnregisterServiceResponse) {
        option (google.api.http) = {
            post: "/v1/services/unregister"
            body: "*"
        };
    }
    rpc InitiateOAuth2Flow(InitiateOAuth2FlowRequest) returns (InitiateOAuth2FlowResponse) {
        option (google.api.http) = {
            post: "/v1/services/oauth2/initiate"
            body: "*"
        };
    }
    rpc RegisterTools(RegisterToolsRequest) returns (RegisterToolsResponse) {
        option (google.api.http) = {
            post: "/v1/services/tools/register"
            body: "*"
        };
    }
    rpc GetServiceStatus(GetServiceStatusRequest) returns (GetServiceStatusResponse) {
        option (google.api.http) = {
            get: "/v1/services/{service_name}/status"
        };
    }
    rpc ListServices(ListServicesRequest) returns (ListServicesResponse) {
        option (google.api.http) = {
            get: "/v1/services"
        };
    }
    rpc GetService(GetServiceRequest) returns (GetServiceResponse) {
        option (google.api.http) = {
            get: "/v1/services/{service_name}"
        };
    }
}

message ListServicesRequest {}

message ListServicesResponse {
    repeated mcpany.config.v1.UpstreamServiceConfig services = 1;
}

message InitiateOAuth2FlowRequest {
  string service_id = 1;
  string namespace = 2;
  string credential_id = 3;
  string redirect_url = 4;
}

message InitiateOAuth2FlowResponse {
  string authorization_url = 1;
  string state = 2;
}

message UnregisterServiceRequest {
  string service_name = 1;          // User-defined unique ID for the service to deregister
  string namespace = 2;               // Optional namespace for the service
}

message UnregisterServiceResponse {
  string message = 1;             // e.g., "Service unregistered successfully"
}

message RegisterToolsRequest {
    string service_name = 1;
    string namespace = 2;
    repeated mcpany.config.v1.ToolDefinition tools = 3;
}

message RegisterToolsResponse {
    string message = 1;
    int32 tools_registered = 2;
}

message GetServiceRequest {
    string service_name = 1;
}

message GetServiceResponse {
    mcpany.config.v1.UpstreamServiceConfig service = 1;
}

message GetServiceStatusRequest {
    string service_name = 1;
    string namespace = 2;
}

message GetServiceStatusResponse {
    repeated mcpany.config.v1.ToolDefinition tools = 1;
    map<string, int64> metrics = 2;
}
