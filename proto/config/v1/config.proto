// Copyright 2025 Author(s) of MCP Any
// SPDX-License-Identifier: Apache-2.0

edition = "2023";

package mcpany.config.v1;

import "proto/bus/bus.proto";
import "proto/config/v1/upstream_service.proto";
import "proto/config/v1/auth.proto";

option go_package = "github.com/mcpany/core/proto/config/v1";
option java_outer_classname = "ConfigProto";

// ===================================================================
// Root Server Configuration
// ===================================================================

// McpAnyServerConfig is the root configuration for the entire MCPANY server.
message McpAnyServerConfig {
  // Server-wide operational parameters.
  GlobalSettings global_settings = 1 [json_name = "global_settings"];
  // A list of all configured upstream services that MCP Any can proxy to.
  repeated UpstreamServiceConfig upstream_services = 2 [json_name = "upstream_services"];
  // A list of upstream service collections to load from.
  repeated UpstreamServiceCollection upstream_service_collections = 3 [json_name = "upstream_service_collections"];
  // A list of users authorized to access the server.
  repeated User users = 4 [json_name = "users"];
}

message User {
  // The unique ID of the user (UUID or Username).
  string id = 1 [json_name = "id"];
  // The authentication configuration for the user.
  AuthenticationConfig authentication = 2 [json_name = "authentication"];
  // The list of profile IDs this user has access to.
  repeated string profile_ids = 3 [json_name = "profile_ids"];
}

message GlobalSettings {
  enum LogLevel {
    LOG_LEVEL_UNSPECIFIED = 0;
    LOG_LEVEL_INFO = 1;
    LOG_LEVEL_WARN = 2;
    LOG_LEVEL_ERROR = 3;
    LOG_LEVEL_DEBUG = 4;
  }
  // The address the MCP server listens on.
  string mcp_listen_address = 1 [json_name = "mcp_listen_address"];
  reserved 2; // mcp_basepath
  // The log level for the server.
  LogLevel log_level = 3 [json_name = "log_level"];
  // The message bus configuration.
  bus.MessageBus message_bus = 4 [json_name = "message_bus"];
  // The API key used for authentication.
  string api_key = 5 [json_name = "api_key"];
  // The profiles to enable.
  repeated string profiles = 6 [json_name = "profiles"];
  // The allowed IPs to access the server.
  repeated string allowed_ips = 7 [json_name = "allowed_ips"];
  // Audit logging configuration.
  AuditConfig audit = 8 [json_name = "audit"];
}

message AuditConfig {
  // Whether audit logging is enabled.
  bool enabled = 1 [json_name = "enabled"];
  // The file path to write audit logs to.
  string output_path = 2 [json_name = "output_path"];
  // Whether to log input arguments (caution: might contain secrets).
  bool log_arguments = 3 [json_name = "log_arguments"];
  // Whether to log output results (caution: might contain sensitive data).
  bool log_results = 4 [json_name = "log_results"];
}
