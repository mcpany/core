// Copyright 2025 Author(s) of MCP Any
// SPDX-License-Identifier: Apache-2.0

edition = "2023";

package mcpany.config.v1;

import "google/protobuf/duration.proto";

option go_package = "github.com/mcpany/core/proto/config/v1";
option java_outer_classname = "HealthCheckProto";

// HttpHealthCheck defines a health check mechanism using HTTP requests.
message HttpHealthCheck {
  // The full URL to send the health check request to.
  string url = 1;
  // The expected HTTP status code for a successful check (default: 200).
  int32 expected_code = 2;
  // A substring that must be present in the response body for the check to pass.
  string expected_response_body_contains = 3;
  // The frequency at which to perform the health check.
  google.protobuf.Duration interval = 4;
  // The maximum time to wait for a response before considering the check failed.
  google.protobuf.Duration timeout = 5;
  // The HTTP method to use (e.g., "GET", "HEAD"). Default is "GET".
  string method = 6;
}

// WebsocketHealthCheck defines a health check mechanism for Websocket services.
message WebsocketHealthCheck {
  // The message to send to the websocket server to initiate the check (e.g., "ping").
  string message = 1;
  // A substring that must be present in the response message for the check to pass.
  string expected_response_contains = 2;
  // The frequency at which to perform the health check.
  google.protobuf.Duration interval = 3;
  // The maximum time to wait for a response before considering the check failed.
  google.protobuf.Duration timeout = 4;
  // The full URL of the websocket endpoint.
  string url = 5;
}

// GrpcHealthCheck defines a health check mechanism for gRPC services, typically using the standard Health service.
message GrpcHealthCheck {
  // The name of the gRPC service to check (e.g., "grpc.health.v1.Health").
  string service = 1;
  // The specific gRPC method to call.
  string method = 2;
  // The JSON representation of the request message.
  string request = 3;
  // The JSON representation of the expected response message.
  string expected_response = 4;
  // If true, the connection will use plaintext instead of TLS.
  bool insecure = 5;
  // The frequency at which to perform the health check.
  google.protobuf.Duration interval = 6;
  // The maximum time to wait for a response before considering the check failed.
  google.protobuf.Duration timeout = 7;
}

// CommandLineHealthCheck defines a health check mechanism for CLI-based services.
message CommandLineHealthCheck {
  // The command or method to invoke to check health.
  string method = 1;
  // The input or prompt to pass to the command.
  string prompt = 2;
  // A substring that must be present in the command's output for the check to pass.
  string expected_response_contains = 3;
  // The frequency at which to perform the health check.
  google.protobuf.Duration interval = 4;
  // The maximum time to wait for execution before considering the check failed.
  google.protobuf.Duration timeout = 5;
}

// WebRTCHealthCheck defines a health check mechanism for WebRTC services.
// It can use either HTTP or Websocket for the signaling check.
message WebRTCHealthCheck {
  // The underlying health check mechanism.
  oneof health_check_type {
    HttpHealthCheck http = 1;
    WebsocketHealthCheck websocket = 2;
  }
}
