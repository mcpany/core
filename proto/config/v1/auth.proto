// Copyright 2025 Author(s) of MCP Any
// SPDX-License-Identifier: Apache-2.0

syntax = "proto3";

package mcpany.config.v1;

option go_package = "github.com/mcpany/core/proto/config/v1";
option java_outer_classname = "AuthProto";

// ===================================================================
// Secret Management
// ===================================================================

// SecretValue represents a value that should be treated as a secret.
// It can be a plain text value, an environment variable, a file path, or content fetched from a remote URL.
message SecretValue {
  oneof value {
    string plain_text = 1;
    string environment_variable = 2;
    string file_path = 3;
    RemoteContent remote_content = 4;
    VaultSecret vault = 5;
    AwsSecretManagerSecret aws_secret_manager = 6;
  }
}

// AwsSecretManagerSecret defines the parameters for fetching a secret from AWS Secrets Manager.
message AwsSecretManagerSecret {
  // The name or ARN of the secret.
  string secret_id = 1 [json_name = "secret_id"];
  // Optional: The key to extract from the secret JSON.
  string json_key = 2 [json_name = "json_key"];
  // Optional: The version stage (defaults to AWSCURRENT).
  string version_stage = 3 [json_name = "version_stage"];
  // Optional: The version ID.
  string version_id = 4 [json_name = "version_id"];
  // Optional: The region. If not set, uses environment or profile.
  string region = 5 [json_name = "region"];
  // Optional: Profile to use.
  string profile = 6 [json_name = "profile"];
}

// VaultSecret defines the parameters for fetching a secret from HashiCorp Vault.
message VaultSecret {
  // The address of the Vault server (e.g., "https://vault.example.com").
  string address = 1;
  // The token to authenticate with Vault.
  SecretValue token = 2;
  // The path to the secret in Vault (e.g., "secret/data/my-app/db").
  string path = 3;
  // The key of the secret to retrieve from the path.
  string key = 4;
}

// RemoteContent represents content that is fetched from a remote URL.
message RemoteContent {
  string http_url = 1;
  Authentication auth = 2;
}

// Authentication defines the authentication method to use when fetching remote content.
message Authentication {
  oneof auth_method {
    UpstreamAPIKeyAuth api_key = 1;
    UpstreamBearerTokenAuth bearer_token = 2;
    UpstreamBasicAuth basic_auth = 3;
    UpstreamOAuth2Auth oauth2 = 5;
  }
}

// ===================================================================
// Upstream Authentication Definitions
// ===================================================================

// UpstreamAuthentication defines the authentication method to use when mcpany communicates
// with an upstream service.
message UpstreamAuthentication {
  oneof auth_method {
    UpstreamAPIKeyAuth api_key = 1;
    UpstreamBearerTokenAuth bearer_token = 2;
    UpstreamBasicAuth basic_auth = 3;
    UpstreamOAuth2Auth oauth2 = 5;
    UpstreamMTLSAuth mtls = 6;
  }
  bool use_environment_variable = 4;
}

// UpstreamAPIKeyAuth defines authentication using an API key sent to an upstream.
message UpstreamAPIKeyAuth {
  // The name of the header to carry the API key (e.g., "X-API-Key").
  string header_name = 1;
  // The API key value.
  SecretValue api_key = 2;
}

// UpstreamBearerTokenAuth defines authentication using a bearer token.
message UpstreamBearerTokenAuth {
  // The bearer token.
  SecretValue token = 1;
}

// UpstreamBasicAuth defines authentication using a username and password.
message UpstreamBasicAuth {
  string username = 1;
  SecretValue password = 2;
}

// UpstreamOAuth2Auth defines authentication using the OAuth 2.0 client credentials flow.
message UpstreamOAuth2Auth {
  string token_url = 1;
  SecretValue client_id = 2;
  SecretValue client_secret = 3;
  string scopes = 4;
}

// UpstreamMTLSAuth defines authentication using mutual TLS.
message UpstreamMTLSAuth {
  // Path to the client certificate file.
  string client_cert_path = 1;
  // Path to the client private key file.
  string client_key_path = 2;
  // Path to the CA certificate file for verifying the server's certificate.
  string ca_cert_path = 3;
}

// AuthenticationConfig specifies the authentication method to use.
message AuthenticationConfig {
  oneof auth_method {
    APIKeyAuth api_key = 1 [json_name = "api_key"];
    OAuth2Auth oauth2 = 2 [json_name = "oauth2"];
    // Can be extended with other auth types like JWT, mTLS etc.
  }
}

// APIKeyAuth defines authentication using an API key.
message APIKeyAuth {
  // The name of the parameter carrying the key (e.g., "X-API-Key", "api_key").
  string param_name = 1 [json_name = "param_name"];
  // Where the API key is located.
  enum Location {
    HEADER = 0;
    QUERY = 1;
  }
  Location in = 2 [json_name = "in"];
  // The actual API key value. It's recommended to use a secret management system.
  string key_value = 3 [json_name = "key_value"];
}

// OAuth2Auth defines authentication using the OAuth 2.0 client credentials flow.
message OAuth2Auth {
  string token_url = 3;
  string authorization_url = 4;
  // Space-delimited list of scopes.
  string scopes = 5;
  string issuer_url = 6;
  string audience = 7;
}
