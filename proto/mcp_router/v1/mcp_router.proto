// Copyright 2025 Author(s) of MCP Any
// SPDX-License-Identifier: Apache-2.0

edition = "2023";

package mcpany.mcp_router.v1;

option go_package = "github.com/mcpany/core/proto/mcp_router/v1";

import "google/protobuf/struct.proto"; // For generic JSON-like data
import "google/protobuf/go_features.proto";

option features.(pb.go).api_level = API_OPAQUE;

// Tool represents an MCP Tool exposed by the aggregator.
message Tool {
     // Unique name of the tool (e.g., "serviceName/methodName" or a hash).
     string name = 1;
     // User-friendly display name of the tool.
     string display_name = 2;
     // Description of the tool, typically from the proto annotation.
     string description = 3;
     // The ID of the registered user service that provides this tool.
     string service_id = 4;
     // Fully qualified name of the underlying gRPC method (e.g., /pkg.UserService/Method).
     string underlying_method_fqn = 5;
     // Fully qualified name of the underlying method's request message.
     string request_type_fqn = 6;
     // Fully qualified name of the underlying method's response message.
     string response_type_fqn = 7;
     // The JSON schema of the input arguments.
     google.protobuf.Struct input_schema = 8;
     // The JSON schema of the output results.
     google.protobuf.Struct output_schema = 9;
     // Annotations providing hints about the tool's behavior.
     ToolAnnotations annotations = 11;
     // Indicates if the tool response is a stream.
     bool is_stream = 12;
     // Tags associated with the tool for categorization.
     repeated string tags = 13;
     // List of profiles that have access to this tool.
     repeated string profiles = 14;
     // Integrity check information for the tool definition.
     ToolIntegrity integrity = 15;
}

// ToolIntegrity contains hash information to verify the tool definition.
message ToolIntegrity {
    // The hash value.
    string hash = 1;
    // The algorithm used (e.g. "sha256").
    string algorithm = 2;
}

// ToolAnnotations provides hints about the tool's side effects and behavior.
message ToolAnnotations {
     // A short title for the tool.
     string title = 1;
     // If true, the tool does not modify its environment.
     // Default: false
     bool read_only_hint = 2;
     // If true, the tool may perform destructive updates to its environment. If
     // false, the tool performs only additive updates.
     // (This property is meaningful only when ReadOnlyHint == false.)
     // Default: true
     bool destructive_hint = 3;
     // If true, calling the tool repeatedly with the same arguments will have no
     // additional effect on the its environment.
     // (This property is meaningful only when ReadOnlyHint == false.)
     // Default: false
     bool idempotent_hint = 4;
     // If true, this tool may interact with an "open world" of external entities. If
     // false, the tool's domain of interaction is closed. For example, the world of
     // a web search tool is open, whereas that of a memory tool is not.
     // Default: true
     bool open_world_hint = 5;
     // Overrides for input schema.
     google.protobuf.Struct input_schema = 6;
     // Overrides for output schema.
     google.protobuf.Struct output_schema = 7;
}

// ListToolsRequest is the request for listing tools.
message ListToolsRequest {
    // Future: filtering options
}

// ListToolsResponse contains the list of tools.
message ListToolsResponse {
    // The list of tools.
    repeated Tool tools = 1;
}

// CallToolRequest is the request for executing a tool.
message CallToolRequest {
     // ID of the tool to execute.
     string tool_id = 1;
     // Actual inputs for the tool, as a JSON-like object.
     // The fields should match the fields of the underlying gRPC method's request message.
     google.protobuf.Struct inputs = 2;
}

// CallToolResponse contains the result of a tool execution.
message CallToolResponse {
     // Actual outputs from the tool, as a JSON-like object.
     // The fields will match the fields of the underlying gRPC method's response message.
     google.protobuf.Struct outputs = 1;
}

// A Prompt is a pre-defined template for interacting with a language model.
message Prompt {
    // The unique name of the prompt.
    string name = 1;
    // The display title of the prompt.
    string title = 2;
    // A description of what the prompt does.
    string description = 3;
    // The arguments required by the prompt.
    repeated PromptArgument arguments = 4;
}

// PromptArgument defines an argument for a prompt template.
message PromptArgument {
    // The name of the argument.
    string name = 1;
    // The description of the argument.
    string description = 2;
    // Whether the argument is required.
    bool required = 3;
}

// ListPromptsRequest is the request for listing prompts.
message ListPromptsRequest {
    // Pagination cursor.
    string cursor = 1;
}

// ListPromptsResponse contains the list of prompts.
message ListPromptsResponse {
    // The list of prompts.
    repeated Prompt prompts = 1;
    // The cursor for the next page of results.
    string next_cursor = 2;
}

// GetPromptRequest is the request for retrieving a prompt.
message GetPromptRequest {
    // The name of the prompt to retrieve.
    string name = 1;
    // The arguments to fill in the prompt template.
    google.protobuf.Struct arguments = 2;
}

// GetPromptResponse contains the instantiated prompt messages.
message GetPromptResponse {
    // The description of the prompt.
    string description = 1;
    // The sequence of messages that make up the prompt.
    repeated PromptMessage messages = 2;
}

// PromptMessage represents a single message in a prompt conversation.
message PromptMessage {
    // Role defines who is speaking.
    enum Role {
        USER = 0;
        ASSISTANT = 1;
    }
    // The role of the speaker.
    Role role = 1;
    // The content of the message.
    oneof content {
        TextContent text = 2;
        ImageContent image = 3;
        AudioContent audio = 4;
        ResourceContent resource = 5;
    }
}

// TextContent represents text.
message TextContent {
    // The text content.
    string text = 1;
}

// ImageContent represents an image.
message ImageContent {
    // Base64 encoded image data.
    string data = 1;
    // The MIME type of the image (e.g., "image/png").
    string mime_type = 2;
}

// AudioContent represents audio.
message AudioContent {
    // Base64 encoded audio data.
    string data = 1;
    // The MIME type of the audio.
    string mime_type = 2;
}

// ResourceContent represents an embedded resource.
message ResourceContent {
    // The URI of the resource.
    string uri = 1;
    // The MIME type of the resource.
    string mime_type = 2;
    // The content of the resource.
    oneof content {
        string text = 3;
        bytes blob = 4;
    }
}

// A Resource is a piece of data that can be used by tools or prompts.
message Resource {
     // The unique ID of the resource.
     string id = 1;
     // The name of the resource.
     string name = 2;
     // The description of the resource.
     string description = 3;
     // The type of the resource (e.g., "text", "image", "url").
     string type = 4;
     // The raw content of the resource.
     bytes content = 5;
}

// ListResourcesRequest is the request for listing resources.
message ListResourcesRequest {}

// ListResourcesResponse contains the list of resources.
message ListResourcesResponse {
    // The list of resources.
    repeated Resource resources = 1;
}

// McpRouter provides routing for MCP tools, prompts, and resources.
service McpRouter {
    // ListTools returns a list of available tools.
    rpc ListTools(ListToolsRequest) returns (ListToolsResponse);
    // CallTool executes a specific tool.
    rpc CallTool(CallToolRequest) returns (CallToolResponse);

    // ListPrompts returns a list of available prompts.
    rpc ListPrompts(ListPromptsRequest) returns (ListPromptsResponse);
    // GetPrompt retrieves a specific prompt, potentially filling in arguments.
    rpc GetPrompt(GetPromptRequest) returns (GetPromptResponse);
    // ListResources returns a list of available resources.
    rpc ListResources(ListResourcesRequest) returns (ListResourcesResponse);
}
