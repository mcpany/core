# QA Audit Report

**Date:** 2026-01-12
**Time:** 01:39:26
**Auditor:** Jules

## Documents Audited

1.  `docs/alerts-feature.md`
2.  `docs/traces-feature.md`
3.  `server/docs/features/hot_reload.md`
4.  `server/docs/features/caching/README.md`
5.  `server/docs/features/monitoring/README.md`

## Verification Table

| Document | Step/Claim | Outcome | Evidence |
| :--- | :--- | :--- | :--- |
| `docs/alerts-feature.md` | Route `/alerts` and components `AlertsPage`, `AlertList`, `AlertStats` exist. | **Pass** | Verified files in `ui/src/app/alerts` and `ui/src/components/alerts`. Logic matches documentation. |
| `docs/traces-feature.md` | Route `/traces` and components `TraceList`, `TraceDetail` exist. | **Pass** | Verified files in `ui/src/app/traces`. `TraceDetail` includes `WaterfallItem` and `handleReplay` as described. |
| `server/docs/features/hot_reload.md` | Config watcher and dynamic reload support. | **Pass** | Verified `server/pkg/config/watcher.go` implementation using `fsnotify`. |
| `server/docs/features/caching/README.md` | `mcpany_cache_hits` metric. | **Pass** | Verified `server/pkg/middleware/cache.go` uses `metrics.IncrCounterWithLabels` which adds `mcpany_` prefix. |
| `server/docs/features/monitoring/README.md` | Metric `mcpany_tools_call_total` (standardized name). | **Pass** | **Discrepancy Found & Fixed.** Code used `tool_executions_total`. |

## Changes Made

### Documentation Edits
*   None. (Documentation was found to be the source of truth for the desired state).

### Code Remediation
*   **Renamed Metrics**: Updated `server/pkg/middleware/tool_metrics.go` to align with `server/docs/features/monitoring/README.md` and standard naming conventions (`mcpany_` prefix).
    *   `tool_executions_total` -> `mcpany_tools_call_total`
    *   `tool_execution_duration_seconds` -> `mcpany_tools_call_latency_seconds`
    *   `tool_execution_input_bytes` -> `mcpany_tools_call_input_bytes`
    *   `tool_execution_output_bytes` -> `mcpany_tools_call_output_bytes`
    *   `tool_execution_tokens_total` -> `mcpany_tools_call_tokens_total`
    *   `tool_executions_in_flight` -> `mcpany_tools_call_in_flight`
*   **Updated Tests**: Updated `server/pkg/middleware/tool_metrics_test.go` to assert on the new metric names.
*   **Exported Helper**: Exported `CalculateToolResultTokens` in `server/pkg/middleware/protocol_metrics.go` to allow reuse in `tool_metrics.go` (resolving a compilation error during verification).

## Roadmap Alignment
*   **Alerts & Incidents**: Implemented and documented.
*   **Traces (Traffic Inspector & Replay)**: Implemented and documented. Matches "Distributed Tracing" and "Agent Debugger" roadmap items.
*   **Monitoring**: Metrics alignment ensures the "Observability Dashboard" displays correct data as expected by the roadmap.

## Security Notes
*   Report scrubbed of all sensitive information.
*   No secrets or API keys detected in verified documents or code changes.
